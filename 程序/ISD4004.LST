C51 COMPILER V9.01   ISD4004                                                               10/27/2015 21:35:25 PAGE 1   


C51 COMPILER V9.01, COMPILATION OF MODULE ISD4004
OBJECT MODULE PLACED IN ISD4004.OBJ
COMPILER INVOKED BY: D:\Program Files (x86)\KEIL4\C51\BIN\C51.EXE ISD4004.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          #include"ISD4004.h"
   2          #include <intrins.h>
   3          
   4          void delayms(unsigned char ms)// 延时子程序 
   5          {      
   6   1              unsigned char j;
   7   1              while(ms--)
   8   1              {
   9   2                      for(j = 0; j < 120; j++);
  10   2              }
  11   1      }
  12          
  13          ////////////////放音部分子程序，放音地址由ADDR决定////
  14          void play(unsigned int addr)
  15          {  
  16   1              unsigned int y;
  17   1              SS=0;
  18   1              MOSI=0;//发送开始
  19   1              SCLK=0;
  20   1              for(y=0;y<8;y++)//上电
  21   1              {
  22   2                      SCLK=0;
  23   2                      if((ISDPOWERUP>>y)&0x01)MOSI=1;
  24   2                      else MOSI=0;
  25   2                      _nop_();
  26   2                      _nop_();
  27   2                      _nop_();
  28   2                      SCLK=1;
  29   2                      _nop_();
  30   2                      _nop_();
  31   2                      _nop_();
  32   2              }//发送结束
  33   1              SS=1;//上电结束
  34   1              delayms(50);
  35   1              SS=0;
  36   1              SCLK=0;
  37   1              for(y=0;y<16;y++)
  38   1              {
  39   2                      SCLK=0;
  40   2                      if((addr>>y)&0x01)MOSI=1;
  41   2                      else MOSI=0;
  42   2                      _nop_();
  43   2                      _nop_();
  44   2                      _nop_();
  45   2                      SCLK=1;
  46   2                      _nop_();
  47   2                      _nop_();
  48   2                      _nop_();
  49   2              }//发送地址结束
  50   1              MOSI=0;//放音
  51   1              SCLK=0;
  52   1              for(y=0;y<8;y++)//从指定地址开始放音
  53   1              {
  54   2                      SCLK=0;
  55   2                      if((PLAYSET>>y)&0x01)MOSI=1;
C51 COMPILER V9.01   ISD4004                                                               10/27/2015 21:35:25 PAGE 2   

  56   2                      else MOSI=0;
  57   2                      _nop_();
  58   2                      _nop_();
  59   2                      _nop_();
  60   2                      SCLK=1;
  61   2                      _nop_();
  62   2                      _nop_();
  63   2                      _nop_();
  64   2              }
  65   1              for(y=0;y<8;y++)//从当前地址开始放音
  66   1              {
  67   2                      SCLK=0;
  68   2                      if((PLAYCUR>>y)&0x01)MOSI=1;
  69   2                      else MOSI=0;
  70   2                      _nop_();
  71   2                      _nop_();
  72   2                      _nop_();
  73   2                      SCLK=1;
  74   2                      _nop_();
  75   2                      _nop_();
  76   2                      _nop_();
  77   2              }
  78   1              SS=1;   
  79   1      } 
  80          //////////////////////////录音部分子程序，地址由ADDR决定/////////////////////////
  81          void rec(unsigned int addr)               
  82          {  
  83   1              unsigned int y; 
  84   1              for(y=0;y<8;y++)
  85   1              {
  86   2                      SCLK=0;
  87   2                      if((ISDPOWERUP>>y)&0x01)MOSI=1;
  88   2                      else MOSI=0;
  89   2                      _nop_();
  90   2                      _nop_();
  91   2                      _nop_();
  92   2                      SCLK=1;
  93   2                      _nop_();
  94   2                      _nop_();
  95   2                      _nop_();
  96   2              }
  97   1              for(y=0;y<8;y++)
  98   1              {
  99   2                      SCLK=1;
 100   2                      if((ISDPOWERUP>>y)&0x01)MOSI=1;
 101   2                      else MOSI=0;
 102   2                      _nop_();
 103   2                      _nop_();
 104   2                      _nop_();
 105   2                      SCLK=0;
 106   2                      _nop_();
 107   2                      _nop_();
 108   2                      _nop_();
 109   2              }//发送结束
 110   1              SS=1;//上电结束
 111   1              delayms(50);
 112   1              delayms(50);
 113   1              SS=0;
 114   1              MOSI=0;//发送地址
 115   1              SCLK=0;
 116   1              for(y=0;y<16;y++)
 117   1              {
C51 COMPILER V9.01   ISD4004                                                               10/27/2015 21:35:25 PAGE 3   

 118   2                      SCLK=0;
 119   2                      if((addr>>y)&0x01)MOSI=1;
 120   2                      else MOSI=0;
 121   2                      _nop_();
 122   2                      _nop_();
 123   2                      _nop_();
 124   2                      SCLK=1;
 125   2                      _nop_();
 126   2                      _nop_();
 127   2                      _nop_();
 128   2              }//发送地址结束
 129   1              MOSI=0;
 130   1              SCLK=0;
 131   1              for(y=0;y<8;y++)  //从指定地址开始录音
 132   1              {
 133   2                      SCLK=0;
 134   2                      if((0xa0>>y)&0x01)MOSI=1;
 135   2                      else MOSI=0;
 136   2                      _nop_();
 137   2                      _nop_();
 138   2                      _nop_();
 139   2                      SCLK=1;
 140   2                      _nop_();
 141   2                      _nop_();
 142   2                      _nop_();
 143   2              }
 144   1              SS=1;
 145   1              SS=0;
 146   1              MOSI=0;
 147   1              SCLK=0;
 148   1              for(y=0;y<8;y++) //从当前地址开始录音
 149   1              {
 150   2                      SCLK=0;
 151   2                      if((0xb0<<y)&0x01)MOSI=1;
 152   2                      else MOSI=0;
 153   2                      _nop_();
 154   2                      _nop_();
 155   2                      _nop_();
 156   2                      SCLK=1;
 157   2                      _nop_();
 158   2                      _nop_();
 159   2                      _nop_();
 160   2              }
 161   1              SS=1;   
 162   1      }
 163          
 164          ////////////////////////////////////
 165          ////////////////////////////////
 166          void stop()
 167          {
 168   1              unsigned char y;
 169   1              SS=1;
 170   1              SS=0;
 171   1              MOSI=0;
 172   1              SCLK=0;
 173   1              for(y=0;y<8;y++)//停止当前操作
 174   1              {
 175   2                      SCLK=1;
 176   2                      if((OPERSTOP>>y)&0x01)MOSI=1;
 177   2                      else MOSI=0;
 178   2                      _nop_();
 179   2                      _nop_();
C51 COMPILER V9.01   ISD4004                                                               10/27/2015 21:35:25 PAGE 4   

 180   2                      _nop_();
 181   2                      SCLK=0;
 182   2                      _nop_();
 183   2                      _nop_();
 184   2                      _nop_();
 185   2              }
 186   1              SS=1;
 187   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    599    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
